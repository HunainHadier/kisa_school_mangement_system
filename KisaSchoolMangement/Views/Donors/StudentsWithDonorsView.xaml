<Window x:Class="KisaSchoolMangement.Views.Students.StudentsWithDonorsView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="👨‍🎓 Students with Donors Management" 
        Height="800" 
        Width="1200"
        WindowStartupLocation="CenterOwner"
        Background="#f5f6fa"
        WindowState="Maximized">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <Border Grid.Row="0" Background="White" CornerRadius="10" Padding="20" Margin="15,15,15,10"
                BorderBrush="#e0e0e0" BorderThickness="1">
            <StackPanel>
                <TextBlock Text="👨‍🎓 Students with Donors Management" 
                           FontSize="26" 
                           FontWeight="Bold" 
                           Foreground="#2c3e50"/>
                <TextBlock Text="View all students with their assigned donors and export data to Excel" 
                           FontSize="13" 
                           Foreground="#7f8c8d" 
                           Margin="0,5,0,0"/>
            </StackPanel>
        </Border>

        <!-- Controls Section -->
        <Border Grid.Row="1" Background="White" CornerRadius="10" Padding="15" Margin="15,0,15,10"
                BorderBrush="#e0e0e0" BorderThickness="1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search Box -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="🔍 Search:" 
                               FontWeight="SemiBold" 
                               Foreground="#2c3e50" 
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"/>
                    <TextBox x:Name="txtSearch" 
                             Width="250" 
                             Height="30" 
                             Padding="10,0"
                             TextChanged="TxtSearch_TextChanged"
                             ToolTip="Search students by name, class, or donor"/>
                </StackPanel>

                <!-- Filter Controls -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                    <ComboBox x:Name="cmbClassFilter" 
                              Width="150" 
                              Height="30" 
                              Margin="5,0"
                              ToolTip="Filter by class"
                              SelectionChanged="CmbClassFilter_SelectionChanged">
                        <ComboBoxItem Content="All Classes" IsSelected="True"/>
                    </ComboBox>

                    <ComboBox x:Name="cmbDonorFilter" 
                              Width="150" 
                              Height="30" 
                              Margin="5,0"
                              ToolTip="Filter by donor"
                              SelectionChanged="CmbDonorFilter_SelectionChanged">
                        <ComboBoxItem Content="All Donors" IsSelected="True"/>
                    </ComboBox>
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="10,0">
                    <Button Content="🔄 Refresh" 
                            Click="BtnRefresh_Click" 
                            Width="100" Height="35"
                            Background="#3498db" 
                            Foreground="White" 
                            FontWeight="SemiBold"
                            ToolTip="Refresh data"/>
                </StackPanel>

                <StackPanel Grid.Column="3" Orientation="Horizontal">
                    <Button Content="📈 Export Excel" 
                            Click="BtnExportExcel_Click" 
                            Width="120" Height="35"
                            Background="#e67e22" 
                            Foreground="White" 
                            FontWeight="SemiBold"
                            ToolTip="Export data to Excel file"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Data Grid Section -->
        <Border Grid.Row="2" Background="White" CornerRadius="10" Padding="0" Margin="15,0,15,10"
                BorderBrush="#e0e0e0" BorderThickness="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- DataGrid Header -->
                <Border Grid.Row="0" Background="#34495e" CornerRadius="10,10,0,0" Padding="15">
                    <Grid>
                        <TextBlock Text="📋 Students with Donor Assignments" 
                                   FontSize="16" 
                                   FontWeight="Bold" 
                                   Foreground="White"/>
                        <TextBlock x:Name="txtRecordCount" 
                                   Text="Total Records: 0" 
                                   FontSize="12" 
                                   Foreground="#bdc3c7" 
                                   HorizontalAlignment="Right"/>
                    </Grid>
                </Border>

                <!-- DataGrid with ScrollViewers -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                    <DataGrid x:Name="dgStudentsWithDonors" 
                              AutoGenerateColumns="False" 
                              IsReadOnly="True"
                              SelectionMode="Single"
                              HeadersVisibility="Column"
                              CanUserSortColumns="True"
                              MinHeight="400">
                        <DataGrid.Columns>
                            <!-- Student Information -->
                            <DataGridTextColumn Header="👤 Student ID" 
                                               Binding="{Binding StudentId}" 
                                               Width="80"/>
                            <DataGridTextColumn Header="🎓 Student Name" 
                                               Binding="{Binding StudentName}" 
                                               Width="180"/>
                            <DataGridTextColumn Header="📞 Student Phone" 
                                               Binding="{Binding StudentPhone}" 
                                               Width="120"/>
                            <DataGridTextColumn Header="🏫 Class" 
                                               Binding="{Binding ClassName}" 
                                               Width="100"/>
                            <DataGridTextColumn Header="📖 Section" 
                                               Binding="{Binding SectionName}" 
                                               Width="80"/>

                            <!-- Donor Information -->
                            <DataGridTextColumn Header="🤝 Donor ID" 
                                               Binding="{Binding DonorId}" 
                                               Width="70"/>
                            <DataGridTextColumn Header="💼 Donor Name" 
                                               Binding="{Binding DonorName}" 
                                               Width="180"/>
                            <DataGridTextColumn Header="📧 Donor Email" 
                                               Binding="{Binding DonorEmail}" 
                                               Width="200"/>
                            <DataGridTextColumn Header="📞 Donor Phone" 
                                               Binding="{Binding DonorPhone}" 
                                               Width="120"/>
                            <DataGridTextColumn Header="💰 Donation Type" 
                                               Binding="{Binding DonationType}" 
                                               Width="120"/>
                            <DataGridTextColumn Header="💵 Amount" 
                                               Binding="{Binding DonationAmount, StringFormat={}{0:C}}" 
                                               Width="100"/>

                            <!-- Assignment Details -->
                            <DataGridTextColumn Header="📅 Assigned Date" 
                                               Binding="{Binding AssignedDate, StringFormat=yyyy-MM-dd}" 
                                               Width="100"/>
                            <DataGridTextColumn Header="📝 Notes" 
                                               Binding="{Binding Notes}" 
                                               Width="150"/>

                            <!-- Status -->
                            <DataGridTextColumn Header="✅ Status" 
                                               Binding="{Binding Status}" 
                                               Width="80">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                        <Setter Property="Padding" Value="5,2"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Status}" Value="Active">
                                                <Setter Property="Foreground" Value="#27ae60"/>
                                                <Setter Property="Background" Value="#d5edda"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Status}" Value="Inactive">
                                                <Setter Property="Foreground" Value="#e74c3c"/>
                                                <Setter Property="Background" Value="#f8d7da"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Status}" Value="Pending">
                                                <Setter Property="Foreground" Value="#f39c12"/>
                                                <Setter Property="Background" Value="#fff3cd"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <!-- Actions -->
                            <DataGridTemplateColumn Header="⚡ Actions" Width="80">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button Content="🗑️" 
                                                    Click="BtnRemoveAssignment_Click" 
                                                    Background="#e74c3c" 
                                                    Foreground="White" 
                                                    Width="25" Height="25"
                                                    Margin="2"
                                                    ToolTip="Remove assignment"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </ScrollViewer>

                <!-- Summary Section -->
                <Border Grid.Row="2" Background="#f8f9fa" Padding="10" CornerRadius="0,0,10,10">
                    <Grid>
                        <TextBlock x:Name="txtSummary" 
                                   Text="📊 Summary: 0 students found" 
                                   FontSize="12" 
                                   FontWeight="SemiBold" 
                                   Foreground="#495057"/>
                        <TextBlock Text="💡 Tip: Use search and filters to find specific records" 
                                   FontSize="10" 
                                   Foreground="#6c757d" 
                                   HorizontalAlignment="Right"/>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- Status Bar -->
        <StatusBar Grid.Row="3" Background="#2c3e50" Height="30" Margin="15,0,15,15">
            <StatusBarItem>
                <TextBlock x:Name="txtStatus" Text="✅ Ready - Students with Donors Management" 
                           Foreground="White" FontWeight="SemiBold"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock Text="🏫 Kisa School Management System" 
                           Foreground="#bdc3c7" FontSize="11"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>